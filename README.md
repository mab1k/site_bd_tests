# Описание тестовой базы данных

## База данных: testdb

### Таблица: testtable

#### Поля:

- id
- name

### Таблица: testtable1

#### Поля:

- id
- name1

# Описание функций тестирования соединения и таблиц в базе данных

## `test_conn_DB()`

*   **Описание:**  Проверяет успешность подключения к базе данных PostgreSQL.
*   **Параметры:**  Нет.
*   **Логика:**
    1.  Выводит сообщение "connDB" и "Проверка соединения с базой" в консоль.
    2.  Пытается установить соединение с базой данных `testdb` с использованием указанных параметров (имя базы данных, пользователь, пароль, хост, порт).
    3.  Если соединение установлено успешно, устанавливает флаг `flag` в 1 и выполняет `assert True` (что всегда проходит успешно).
    4.  Если при подключении возникает ошибка `psycopg2.Error`, выполняет `assert False` (что приводит к провалу теста).
    5.  В блоке `finally`, если флаг `flag` установлен (соединение было установлено), закрывает соединение и выводит пустую строку в консоль.
*   **Возвращаемое значение:**  Нет (функция ничего не возвращает явно).  Результат теста определяется по наличию/отсутствию ошибки `AssertionError`.
*   **Зависимости:** Использует библиотеку `psycopg2`.

## `test_tables_DB()`

*   **Описание:** Проверяет работоспособность запроса к базе данных и возможность получить список всех таблиц.
*   **Параметры:** Нет.
*   **Логика:**
    1.  Выводит сообщение "test_tables_DB" и "Проверка на работоспособность запроса и нахождение всех таблиц в базе." в консоль.
    2.  Пытается установить соединение с базой данных `testdb`.
    3.  Создает курсор для выполнения SQL-запросов.
    4.  Выполняет SQL-запрос `SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'`, чтобы получить список таблиц из схемы `public`.
    5.  Если запрос выполнен успешно, устанавливает флаг `flag` в 1 и выполняет `assert True`.
    6.  Если при подключении или выполнении запроса возникает ошибка `psycopg2.Error`, выполняет `assert False`.
    7.  В блоке `finally`, если флаг `flag` установлен, закрывает соединение и выводит пустую строку в консоль.
*   **Возвращаемое значение:**  Нет. Результат теста определяется по наличию/отсутствию ошибки `AssertionError`.
*   **Зависимости:** Использует библиотеку `psycopg2`


## `test_fields_testtable_DB()`

*   **Описание:** Проверяет возможность подключения к базе данных и выполнения запроса для получения информации о полях таблицы `testtable`.  Фактически не проверяет, получены ли поля, а только проверяет, что запрос выполняется без ошибок.
*   **Параметры:** Нет.
*   **Логика:**
    1.  Выводит сообщения "test_fields_testtable_DB" и "Проверка на получение всех полей из таблицы" в консоль.
    2.  Пытается установить соединение с базой данных `testdb` с использованием указанных параметров.
    3.  Создает курсор для выполнения SQL-запросов.
    4.  Выполняет SQL-запрос `SELECT * FROM testtable LIMIT 0`.
    5.  Если запрос выполнен успешно, устанавливает флаг `flag` в 1 и выполняет `assert True` (что всегда проходит успешно, если нет исключений).
    6.  Если при подключении или выполнении запроса возникает исключение `psycopg2.Error`, выполняется `assert False, f"Ошибка при подключении или выполнении запроса: {e}"`. Это приведет к провалу теста, и будет выведено сообщение об ошибке.
    7.  В блоке `finally`, если флаг `flag` установлен (соединение было установлено), закрывает соединение и выводит пустую строку в консоль.
*   **Возвращаемое значение:** Нет. Результат теста определяется по наличию/отсутствию ошибки `AssertionError`.
*   **Зависимости:** Использует библиотеку `psycopg2`.

## `test_fields_testtable1_DB()`

*   **Описание:** Проверяет возможность подключения к базе данных и выполнения запроса для получения информации о полях таблицы `testtable1`. Фактически не проверяет, получены ли поля, а только проверяет, что запрос выполняется без ошибок.
*   **Параметры:** Нет.
*   **Логика:**
    1.  Выводит сообщения "test_fields_testtable1_DB" и "Проверка на получение всех полей из таблицы" в консоль.
    2.  Пытается установить соединение с базой данных `testdb` с использованием указанных параметров.
    3.  Создает курсор для выполнения SQL-запросов.
    4.  Выполняет SQL-запрос `SELECT * FROM testtable1 LIMIT 0`.
    5.  Если запрос выполнен успешно, устанавливает флаг `flag` в 1 и выполняет `assert True`.
    6.  Если при подключении или выполнении запроса возникает исключение `psycopg2.Error`, выполняется `assert False, f"Ошибка при подключении или выполнении запроса: {e}"`.
    7.  В блоке `finally`, если флаг `flag` установлен, закрывает соединение и выводит пустую строку в консоль.
*   **Возвращаемое значение:** Нет. Результат теста определяется по наличию/отсутствию ошибки `AssertionError`.
*   **Зависимости:** Использует библиотеку `psycopg2`.

## `test_testdb_tables_JSON_DB()`

*   **Описание:**  Проверяет соответствие между списком таблиц, описанных в JSON-файле (`data.json`), и списком таблиц в базе данных.  Выводит информацию о несовпадениях (таблицы, присутствующие в JSON, но отсутствующие в базе данных, или наоборот).
*   **Параметры:** Нет.
*   **Логика:**
    1.  Открывает и загружает JSON-файл `data.json`.
    2.  Получает имя базы данных из JSON.
    3.  Устанавливает соединение с базой данных.абл
    4.  Создает курсор для выполнения SQL-запросов.
    5.  Выполняет SQL-запрос `SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'`.
    6.  Получает список названий таблиц из JSON-файла.
    7.  Получает список названий таблиц из базы данных.
    8.  Проверяет соответствие списков таблиц:
        *   **Случай 1: Списки одинаковой длины и совпадают:**  Если списки таблиц из JSON и базы данных имеют одинаковую длину и содержат одни и те же элементы (после сортировки), то выполняется `assert True`.
        *   **Случай 2: В JSON таблиц больше, чем в базе данных:** Если в JSON таблиц больше, чем в базе данных, выводится сообщение о том, что таблицы, содержащиеся в JSON, отсутствуют в базе данных. Затем создается таблица (с использованием `tabulate`), показывающая названия этих таблиц.  Выполняется `assert False`.
        *   **Случай 3: В JSON таблиц меньше, чем в базе данных:** Если в JSON таблиц меньше, чем в базе данных, и все таблицы из JSON присутствуют в базе данных (проверка с использованием функции `contains_all`), то выводится сообщение о том, что в JSON таблиц меньше, чем в базе данных, а также создается таблица, показывающая названия таблиц, присутствующих в базе данных, но отсутствующих в JSON.  Выполняется `assert True`.
        *   **Случай 4: Таблицы в JSON и базе данных не пересекаются:** Если ни одно из предыдущих условий не выполняется, выводится сообщение о том, что таблицы в JSON и базе данных не пересекаются, и выполняется `assert False`.
    9. В блоке `except` обрабатываются исключения, которые могут возникнуть при работе с базой данных (`psycopg2.Error`), при открытии JSON-файла (`FileNotFoundError`) и при чтении JSON-файла (`json.JSONDecodeError`). В каждом случае выполняется `assert False` с информативным сообщением об ошибке.
    10. В блоке `finally`, закрывает соединение с базой данных.
*   **Возвращаемое значение:**  Нет. Результат теста определяется по наличию/отсутствию ошибки `AssertionError`.
*   **Зависимости:** Использует библиотеки `psycopg2`, `json`, `tabulate` (требуется установка: `pip install tabulate`).
*   **Дополнительные функции:**
    *   Использует функцию `get_elements_only_in_list1(list1, list2)` (возвращает список элементов, которые есть в `list1`, но отсутствуют в `list2`).
    *   Использует функцию `contains_all(list1, list2)` (проверяет, содержатся ли все элементы `list2` в `list1`).

## `test_fields_testtable_JSON_DB()`

*   **Описание:**  Проверяет соответствие списка полей таблицы `testtable` (взятого первым из JSON) в базе данных с полями, описанными в JSON-файле (`data.json`). Выводит в консоль информацию о любых несовпадениях.
*   **Параметры:** Нет.
*   **Логика:**
    1.  Открывает и загружает JSON-файл `data.json`.
    2.  Получает имя базы данных из JSON (ключ верхнего уровня).
    3.  Получает имя первой таблицы из JSON (первый ключ в словаре, соответствующем имени базы данных).
    4.  Устанавливает соединение с базой данных, используя имя базы данных из JSON и стандартные параметры подключения.
    5.  Выполняет SQL-запрос `SELECT * FROM {name_table} LIMIT 0` для получения информации о структуре таблицы (именах полей) без выборки данных.
    6.  Извлекает имена полей из `cursor.description` (список кортежей, где первый элемент каждого кортежа – имя поля).
    7.  Получает список полей, описанных для этой таблицы в JSON-файле.
    8. Сортирует списки полей из базы данных и из JSON.
    9. Сравнивает списки полей:
        *   **Случай 1: Списки имеют одинаковую длину и совпадают:** Если списки полей из JSON и базы данных имеют одинаковую длину и совпадают (после сортировки), то выводит сообщение "Все поля в таблице {name_table} совпадают." и выполняет `assert True`.
        *   **Случай 2: Списки имеют одинаковую длину, но не совпадают:** Если списки имеют одинаковую длину, но не совпадают, выводит сообщение "Обнаружены несовпадения:" и затем выводит подробную информацию о каждом несовпадении (имя базы данных, имя таблицы, индекс несовпадающего поля, значение поля в JSON, значение поля в базе данных). После чего выполняет `assert False`.
        *   **Случай 3: Списки имеют разную длину:** Если списки имеют разную длину, выводит сообщение "Количество полей в базе и в JSON не совпадают" и выполняет `assert False`.
    10. В блоке `except` обрабатываются исключения, которые могут возникнуть при работе с базой данных (`psycopg2.Error`), при открытии JSON-файла (`FileNotFoundError`) и при чтении JSON-файла (`json.JSONDecodeError`), выполняя `assert False` с информативным сообщением об ошибке.
    11. В блоке `finally` закрывает соединение с базой данных.
*   **Возвращаемое значение:**  Нет. Результат теста определяется по наличию/отсутствию ошибки `AssertionError`.
*   **Зависимости:** Использует библиотеки `psycopg2` и `json`.

## `def test_fields_testtable1_JSON_DB()`
*   **Описание:** Аналогчно функции `test_fields_testtable_JSON_DB()`, только для другой таблицы.
